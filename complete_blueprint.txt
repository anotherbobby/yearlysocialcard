ğŸš€ FARCASTER YEARLY SOCIAL TRADING CARD â€” BLUEPRINT v2.0
================================================================================

                    COMPLETE â€¢ OPTIMIZED â€¢ PRODUCTION-READY

================================================================================
                              TABLE OF CONTENTS
================================================================================

 1. Executive Summary
 2. Core Concept & User Journey
 3. Technical Architecture
 4. Smart Contract Specification
 5. Data Structure & Gas Optimization
 6. Rarity System & Calculation
 7. Stats Verification & Security
 8. NFT Metadata & SVG Generation
 9. Royalty System (ERC2981)
10. Minting Rules & Eligibility
11. Leaderboard System
12. Frame Integration (Farcaster)
13. Economic Model & Sustainability
14. Deployment Guide
15. Testing Strategy
16. Edge Cases & Error Handling
17. Roadmap & Future Features
18. Appendix & Resources


================================================================================
1ï¸âƒ£ EXECUTIVE SUMMARY
================================================================================

PROJECT: Farcaster Yearly Social Trading Card
TAGLINE: Turn your Farcaster activity into a collectible NFT

WHAT IT IS:
An NFT trading card system that captures a user's Farcaster social activity 
over 1 year, with beautiful on-chain SVG art, rarity tiers, and perpetual 
royalties to minters.

KEY FEATURES:
âœ… 1 mint per user per calendar year
âœ… 7 comprehensive stats (casts, likes, replies, recasts, followers, etc.)
âœ… 5 rarity tiers (Common â†’ Legendary)
âœ… Fully on-chain metadata + SVG (no IPFS)
âœ… 3% perpetual royalties to original minter
âœ… Integrated Farcaster Frame for seamless minting
âœ… Gas-optimized for Base L2 (~$0.60 per mint)

TARGET USERS:
- Active Farcaster users wanting social proof
- NFT collectors seeking utility + aesthetics
- Early adopters wanting passive royalty income

TECHNICAL STACK:
- Blockchain: Base L2 (Ethereum)
- Smart Contract: Solidity 0.8.20 (Solady optimized)
- Backend: Node.js + Express
- Stats Provider: Neynar API
- Cache: Redis (leaderboard)
- Frontend: Farcaster Frame (Frog framework)


================================================================================
2ï¸âƒ£ CORE CONCEPT & USER JOURNEY
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CONCEPT OVERVIEW                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Setiap user Farcaster dapat mint 1 trading card per tahun yang     â”‚
â”‚ merekam aktivitas sosial mereka selama 365 hari terakhir.          â”‚
â”‚                                                                     â”‚
â”‚ Card berisi:                                                        â”‚
â”‚ â€¢ 7 stats komprehensif (casts, likes, engagement, dll)             â”‚
â”‚ â€¢ Rarity tier berdasarkan performa                                 â”‚
â”‚ â€¢ Beautiful SVG art (fully on-chain)                               â”‚
â”‚ â€¢ Tradeable di OpenSea/Blur dengan 3% royalty ke minter            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

USER JOURNEY:

Step 1: Discovery
â”œâ”€ User melihat cast dari teman yang baru mint card
â”œâ”€ Click frame link â†’ masuk ke mini-app
â””â”€ Melihat "Mint Your 2025 Card" CTA

Step 2: Preview Stats
â”œâ”€ Frame fetch stats dari Neynar API
â”œâ”€ Display preview: 7 stats + predicted rarity tier
â””â”€ User melihat "You'll get LEGENDARY tier!"

Step 3: Mint Decision
â”œâ”€ User click "Mint Now (0.0005 ETH)"
â”œâ”€ Wallet popup (MetaMask/Coinbase Wallet)
â”œâ”€ Total cost displayed: ~$2.10 (fee + gas)
â””â”€ User confirm transaction

Step 4: Minting
â”œâ”€ Backend generate signature untuk verify stats
â”œâ”€ Transaction submitted to Base chain
â”œâ”€ Contract verify signature + mint NFT + generate SVG
â””â”€ ~15 seconds later â†’ success!

Step 5: Share & Trade
â”œâ”€ Frame menampilkan beautiful card (SVG rendered)
â”œâ”€ User click "Share to Farcaster" â†’ auto-generate cast
â”œâ”€ Card listed on OpenSea automatically
â””â”€ Future sales â†’ 3% royalty langsung ke minter wallet

ELIGIBILITY RULES:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Rule 1: 1 mint per calendar year per FID                   â”‚
â”‚ Rule 2: Stats window = 365 days rolling dari mint date     â”‚
â”‚ Rule 3: Reset eligibility setiap 1 Januari 00:00 UTC       â”‚
â”‚ Rule 4: Must pay exactly 0.0005 ETH mint fee               â”‚
â”‚ Rule 5: Must have valid signature from trusted backend     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

EXAMPLE SCENARIOS:

Scenario A: Normal Flow
â”œâ”€ User mint: 15 Mei 2025 (first time)
â”œâ”€ Stats period: 15 Mei 2024 â†’ 15 Mei 2025
â”œâ”€ Next eligible: 1 Januari 2026
â””â”€ Try mint 10 Juni 2025 â†’ âŒ REJECTED (same year)

Scenario B: Year Transition
â”œâ”€ User mint: 20 Desember 2025
â”œâ”€ Stats period: 20 Des 2024 â†’ 20 Des 2025
â”œâ”€ Next eligible: 1 Januari 2026 (12 hari kemudian)
â”œâ”€ Mint 5 Januari 2026 â†’ âœ… ALLOWED
â””â”€ New stats period: 5 Jan 2025 â†’ 5 Jan 2026

Scenario C: New User (<1 year on Farcaster)
â”œâ”€ FID created: 1 September 2025
â”œâ”€ Try mint: 15 November 2025
â”œâ”€ Stats period: 1 Sep 2025 â†’ 15 Nov 2025 (partial year)
â””â”€ âœ… ALLOWED (stats akan lebih rendah, likely Common tier)


================================================================================
3ï¸âƒ£ TECHNICAL ARCHITECTURE
================================================================================

SYSTEM DIAGRAM:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER (Farcaster App)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Farcaster Frame â”‚
                    â”‚   (Frontend UI)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚              â”‚              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Backend API    â”‚    â”‚    â”‚  Base Blockchain â”‚
    â”‚  (Stats + Sign)  â”‚    â”‚    â”‚  (Smart Contract)â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚             â”‚              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚              â”‚
    â”‚   Neynar API     â”‚    â”‚              â”‚
    â”‚ (Farcaster Stats)â”‚    â”‚              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚              â”‚
                            â”‚              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      Redis       â”‚    â”‚    â”‚   OpenSea API    â”‚
    â”‚  (Leaderboard)   â”‚    â”‚    â”‚  (NFT Indexer)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  User's Wallet â”‚
                    â”‚ (MetaMask, CB) â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DATA FLOW (Detailed):

[1] User clicks "Mint Now" in Frame
      â†“
[2] Frame â†’ Backend API: GET /api/stats/:fid
      â†“
[3] Backend â†’ Neynar API: Fetch 365-day stats
      â†“
[4] Backend calculates rarity score + tier
      â†“
[5] Backend generates signature:
    hash = keccak256(fid, username, stats..., year)
    signature = sign(hash, ORACLE_PRIVATE_KEY)
      â†“
[6] Backend â†’ Frame: Return {stats, signature, rarity}
      â†“
[7] Frame displays preview + "Confirm Mint" button
      â†“
[8] User confirms â†’ Frame calls smart contract mint()
      â†“
[9] Contract verifies signature via ecrecover()
      â†“
[10] If valid â†’ mint NFT + store packed data + emit event
      â†“
[11] Transaction confirmed (~15 sec on Base)
      â†“
[12] Frame â†’ Backend: POST /api/verify (update cache)
      â†“
[13] Frame displays success + share buttons
      â†“
[14] OpenSea auto-indexes NFT within 5 min


================================================================================
4ï¸âƒ£ SMART CONTRACT SPECIFICATION
================================================================================

CONTRACT: FarcasterYearlyCard.sol
VERSION: 1.0.0
LICENSE: MIT

INHERITANCE TREE:
FarcasterYearlyCard
â”œâ”€ ERC721 (from Solady - gas optimized)
â”œâ”€ Ownable (from OpenZeppelin)
â””â”€ IERC2981 (royalty interface)

CONSTANTS:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Name             â”‚ Type             â”‚ Value                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MINT_FEE         â”‚ uint256 constant â”‚ 0.0005 ether           â”‚
â”‚ ROYALTY_BPS      â”‚ uint16 constant  â”‚ 300 (3%)               â”‚
â”‚ MAX_SUPPLY       â”‚ uint256 constant â”‚ type(uint256).max      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STATE VARIABLES:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Variable          â”‚ Type                      â”‚ Storage Cost         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ _cards            â”‚ mapping(uint256=>CardData)â”‚ 2 slots per token    â”‚
â”‚ _lastMintYear     â”‚ mapping(uint32=>uint256)  â”‚ 1 slot per FID       â”‚
â”‚ _fullUsernames    â”‚ mapping(uint256=>string)  â”‚ Optional (lazy)      â”‚
â”‚ _nextTokenId      â”‚ uint256                   â”‚ 1 slot (shared)      â”‚
â”‚ statsOracle       â”‚ address immutable         â”‚ 0 (in bytecode)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STRUCT: CardData (Ultra-Optimized - 2 Storage Slots)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SLOT 1 (256 bits)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ uint32  fid              â”‚ 32 bits  â”‚ Farcaster ID            â”‚
â”‚ uint16  casts            â”‚ 16 bits  â”‚ Total casts (max 65k)   â”‚
â”‚ uint16  likes            â”‚ 16 bits  â”‚ Likes received          â”‚
â”‚ uint16  replies          â”‚ 16 bits  â”‚ Reply count             â”‚
â”‚ uint16  recasts          â”‚ 16 bits  â”‚ Recast count            â”‚
â”‚ uint16  followers        â”‚ 16 bits  â”‚ Followers gained        â”‚
â”‚ uint8   consistency      â”‚ 8 bits   â”‚ Active months (0-12)    â”‚
â”‚ uint8   rarityTier       â”‚ 8 bits   â”‚ Tier (0-4)              â”‚
â”‚ uint16  yearMinted       â”‚ 16 bits  â”‚ Year (2024-2280)        â”‚
â”‚ uint32  mintTimestamp    â”‚ 32 bits  â”‚ Unix timestamp          â”‚
â”‚ uint32  uniqueInteractorsâ”‚ 32 bits  â”‚ Unique users engaged    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         SLOT 2 (256 bits)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ address minter           â”‚ 160 bits â”‚ Original minter         â”‚
â”‚ bytes12 usernameHash     â”‚ 96 bits  â”‚ Short username ref      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TOTAL STORAGE: 512 bits = 2 slots = ~40,000 gas per mint
(vs naive approach: 10+ slots = ~200,000 gas)

MAIN FUNCTIONS:

function mint(
    uint32 fid,
    string calldata username,
    uint16 casts,
    uint16 likes,
    uint16 replies,
    uint16 recasts,
    uint16 followers,
    uint8 consistency,
    uint32 uniqueInteractors,
    bytes calldata signature
) external payable returns (uint256 tokenId)

Description:
- Mints a new yearly card NFT
- Verifies signature from trusted backend
- Calculates rarity tier on-chain
- Stores packed data (2 slots)
- Emits CardMinted event

Checks:
- require(msg.value == MINT_FEE)
- require(!hasMintedThisYear(fid))
- require(consistency <= 12)
- require(verifySignature(hash, signature))

Gas: ~150,000


function tokenURI(uint256 tokenId)
    public view override returns (string memory)

Description:
- Generates full metadata JSON on-the-fly
- Includes embedded base64 SVG image
- No storage cost (computed view function)
- Returns data URI format

Process:
1. Load CardData from storage
2. Generate SVG via _generateSVG()
3. Build JSON with attributes
4. Encode to base64
5. Return data:application/json;base64,...

Gas: ~80,000 (view only, free for users)


function royaltyInfo(uint256 tokenId, uint256 salePrice)
    external view returns (address receiver, uint256 amount)

Description:
- ERC2981 standard implementation
- Returns original minter address + 3% of sale price
- Automatically honored by OpenSea, Blur, etc.

Calculation:
- receiver = _cards[tokenId].minter
- amount = (salePrice * 300) / 10000

Gas: ~5,000 (view only)


function hasMintedThisYear(uint32 fid)
    public view returns (bool)

Description:
- Checks if FID has minted in current calendar year
- Uses simple year comparison

Logic:
uint16 currentYear = uint16(block.timestamp / 365 days + 1970);
return _lastMintYear[fid] == currentYear;

Gas: ~2,000 (view only)


function getCardData(uint256 tokenId)
    external view returns (CardData memory)

Description:
- Returns full unpacked CardData struct
- Useful for external apps/analytics

Gas: ~3,000 (view only)


INTERNAL HELPER FUNCTIONS:

1. _calculateRarity(stats...) â†’ uint8
   - Pure function, no storage reads
   - Weighted formula (detailed in section 6)
   - Returns tier 0-4

2. _generateSVG(CardData) â†’ string
   - Generates premium SVG with gradients
   - Dynamic colors based on rarity
   - ~200 lines of SVG code

3. _verifySignature(hash, signature) â†’ bool
   - ECDSA signature verification
   - Uses ecrecover precompile
   - Checks signer == statsOracle

4. _packUsername(string) â†’ bytes12
   - Hash first 12 bytes for storage
   - Fallback to full storage if needed

5. _getRarityColor(tier) â†’ string
   - Returns hex color for tier
   - Gold/Purple/Blue/Green/Gray

EVENTS:

event CardMinted(
    uint256 indexed tokenId,
    uint32 indexed fid,
    address indexed minter,
    uint8 rarityTier,
    uint16 year
);


================================================================================
5ï¸âƒ£ DATA STRUCTURE & GAS OPTIMIZATION
================================================================================

OPTIMIZATION STRATEGY:

Goal: Reduce mint gas from ~450k (naive) to ~150k (optimized)
Method: Multi-layered optimization approach

LAYER 1: STORAGE PACKING (Save ~150k gas)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Technique: Pack multiple values into single uint256 slots      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Before (Naive):                                                 â”‚
â”‚   struct CardData {                                             â”‚
â”‚       uint256 fid;           // 1 slot                          â”‚
â”‚       uint256 casts;         // 1 slot                          â”‚
â”‚       uint256 likes;         // 1 slot                          â”‚
â”‚       ... (10 total fields)  // 10 slots                        â”‚
â”‚   }                                                             â”‚
â”‚   Cost: 10 slots Ã— 20,000 gas = 200,000 gas                    â”‚
â”‚                                                                 â”‚
â”‚ After (Optimized):                                              â”‚
â”‚   struct CardData {                                             â”‚
â”‚       uint32 fid;            // Share slot 1                    â”‚
â”‚       uint16 casts;          // Share slot 1                    â”‚
â”‚       uint16 likes;          // Share slot 1                    â”‚
â”‚       ... (all in 2 slots)   // 2 slots                         â”‚
â”‚   }                                                             â”‚
â”‚   Cost: 2 slots Ã— 20,000 gas = 40,000 gas                      â”‚
â”‚                                                                 â”‚
â”‚ Savings: 160,000 gas (80% reduction)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LAYER 2: ON-DEMAND COMPUTATION (Save ~30k gas)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Technique: Generate SVG in view function, not in storage       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Before (Naive):                                                 â”‚
â”‚   - Store full SVG string in contract                           â”‚
â”‚   - Cost: ~3-5 KB Ã— 6k gas/KB = 18-30k gas                     â”‚
â”‚                                                                 â”‚
â”‚ After (Optimized):                                              â”‚
â”‚   - Store only raw data (2 slots)                               â”‚
â”‚   - Generate SVG dynamically in tokenURI()                      â”‚
â”‚   - Cost: 0 gas (view function is free)                        â”‚
â”‚                                                                 â”‚
â”‚ Savings: 30,000 gas                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LAYER 3: EFFICIENT ELIGIBILITY CHECK (Save ~20k gas)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Technique: Simple year comparison vs array iteration           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Before (Naive):                                                 â”‚
â”‚   mapping(fid => uint256[]) mintedYears;                        â”‚
â”‚   - Iterate array to check eligibility                          â”‚
â”‚   - Cost: ~5k gas per year Ã— avg 3 years = 15-20k gas          â”‚
â”‚                                                                 â”‚
â”‚ After (Optimized):                                              â”‚
â”‚   mapping(fid => uint256) lastMintYear;                         â”‚
â”‚   - Single SLOAD + comparison                                   â”‚
â”‚   - Cost: ~2k gas                                               â”‚
â”‚                                                                 â”‚
â”‚ Savings: 18,000 gas                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LAYER 4: SOLADY ERC721 (Save ~15k gas)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Technique: Use assembly-optimized ERC721 implementation        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Before: OpenZeppelin ERC721                                     â”‚
â”‚   - Standard Solidity implementation                            â”‚
â”‚   - Mint cost: ~50k gas                                         â”‚
â”‚                                                                 â”‚
â”‚ After: Solady ERC721                                            â”‚
â”‚   - Assembly-optimized hot paths                                â”‚
â”‚   - Mint cost: ~35k gas                                         â”‚
â”‚                                                                 â”‚
â”‚ Savings: 15,000 gas                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LAYER 5: MINIMAL EVENTS (Save ~5k gas)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Technique: Emit only essential events                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Before (Naive):                                                 â”‚
â”‚   - Multiple custom events for each stat                        â”‚
â”‚   - Cost: ~1.5k gas Ã— 5 events = 7.5k gas                      â”‚
â”‚                                                                 â”‚
â”‚ After (Optimized):                                              â”‚
â”‚   - 1 custom event (CardMinted)                                 â”‚
â”‚   - Rely on standard Transfer event                             â”‚
â”‚   - Cost: ~1.5k gas                                             â”‚
â”‚                                                                 â”‚
â”‚ Savings: 6,000 gas                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LAYER 6: IMMUTABLE VARIABLES (Save ~2k gas per read)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Technique: Use immutable for constants set in constructor      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Before:                                                         â”‚
â”‚   address public statsOracle; // storage variable              â”‚
â”‚   Cost: 2.1k gas per SLOAD                                      â”‚
â”‚                                                                 â”‚
â”‚ After:                                                          â”‚
â”‚   address public immutable statsOracle; // in bytecode         â”‚
â”‚   Cost: 3 gas per read                                          â”‚
â”‚                                                                 â”‚
â”‚ Savings: ~2k gas per verification (used once per mint)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TOTAL GAS BREAKDOWN:

Mint Transaction Gas Analysis:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Operation                    â”‚ Gas Cost  â”‚ Optimization       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Base transaction cost        â”‚   21,000  â”‚ Fixed (cannot opt) â”‚
â”‚ Signature verification       â”‚    5,000  â”‚ Precompile (fast)  â”‚
â”‚ Storage (2 slots)            â”‚   40,000  â”‚ Packed data        â”‚
â”‚ Rarity calculation           â”‚    3,000  â”‚ Pure function      â”‚
â”‚ ERC721 mint (Solady)         â”‚   35,000  â”‚ Assembly-opt       â”‚
â”‚ Year tracking update         â”‚    5,000  â”‚ Simple SSTORE      â”‚
â”‚ Event emission               â”‚    1,500  â”‚ Single event       â”‚
â”‚ Function overhead            â”‚   10,000  â”‚ Call stack         â”‚
â”‚ Memory operations            â”‚   12,000  â”‚ Calldata handling  â”‚
â”‚ Refund (gas unused)          â”‚  -15,000  â”‚ Automatic          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TOTAL                        â”‚  ~150,000 â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Comparison Table:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Approach           â”‚ Deploy Gas â”‚ Mint Gas â”‚ Total/User      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Naive (unopt)      â”‚   5.0M     â”‚  450k    â”‚ $3.50 (Base)    â”‚
â”‚ Medium opt         â”‚   3.5M     â”‚  250k    â”‚ $2.00           â”‚
â”‚ Full opt (ours)    â”‚   2.5M     â”‚  150k    â”‚ $0.60           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Cost at Current Base Gas Prices (0.01 gwei):
- Deploy: 2.5M gas Ã— 0.01 gwei = 0.025 gwei â‰ˆ $25-35
- Mint: 150k gas Ã— 0.01 gwei = 0.0015 gwei â‰ˆ $0.50-0.80


================================================================================
6ï¸âƒ£ RARITY SYSTEM & CALCULATION
================================================================================

PHILOSOPHY:

Goals:
âœ… Reward consistent engagement over raw numbers
âœ… Make Legendary tier achievable but challenging
âœ… Balance quantity (casts) with quality (interactions)
âœ… Transparent, reproducible calculation

Design Principles:
- NOT just for influencers (10k+ followers)
- Values authentic community engagement
- Consistency weighted heavily (20%)
- Unique interactors = quality metric

FORMULA:

Weighted Scoring System (Max 100 points):

RarityScore = 
  (Casts / 1000) Ã— 10 +              // Max 10 pts â†’ 1000+ casts
  (Likes / 5000) Ã— 20 +               // Max 20 pts â†’ 5000+ likes
  (Replies / 500) Ã— 12 +              // Max 12 pts â†’ 500+ replies
  (Recasts / 500) Ã— 12 +              // Max 12 pts â†’ 500+ recasts
  (Followers / 200) Ã— 8 +             // Max 8 pts â†’ 200+ followers
  (Consistency / 12) Ã— 20 +           // Max 20 pts â†’ 12/12 months
  (UniqueInteractors / 300) Ã— 18      // Max 18 pts â†’ 300+ users

Total: 100 points maximum

TIER MAPPING:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tier       â”‚ Score Range â”‚ Color   â”‚ Estimated % â”‚ Descriptionâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Legendary  â”‚   85-100    â”‚ #FFD700 â”‚    ~5%      â”‚ Elite      â”‚
â”‚ Epic       â”‚   70-84     â”‚ #9B59B6 â”‚   ~10%      â”‚ Very Activeâ”‚
â”‚ Rare       â”‚   50-69     â”‚ #3498DB â”‚   ~20%      â”‚ Active     â”‚
â”‚ Uncommon   â”‚   30-49     â”‚ #2ECC71 â”‚   ~30%      â”‚ Regular    â”‚
â”‚ Common     â”‚    0-29     â”‚ #95A5A6 â”‚   ~35%      â”‚ Casual     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SAMPLE PROFILES:

Profile A: "The Influencer"
â”œâ”€ Casts: 2000 â†’ 10 pts (capped)
â”œâ”€ Likes: 15000 â†’ 20 pts (capped)
â”œâ”€ Replies: 300 â†’ 7.2 pts
â”œâ”€ Recasts: 800 â†’ 12 pts (capped)
â”œâ”€ Followers: 150 â†’ 6 pts
â”œâ”€ Consistency: 10/12 â†’ 16.7 pts
â”œâ”€ Unique: 250 â†’ 15 pts
â””â”€ TOTAL: 87.9 â†’ LEGENDARY â­

Profile B: "The Consistent Community Builder"
â”œâ”€ Casts: 800 â†’ 8 pts
â”œâ”€ Likes: 3000 â†’ 12 pts
â”œâ”€ Replies: 450 â†’ 10.8 pts
â”œâ”€ Recasts: 350 â†’ 8.4 pts
â”œâ”€ Followers: 180 â†’ 7.2 pts
â”œâ”€ Consistency: 12/12 â†’ 20 pts (full)
â”œâ”€ Unique: 280 â†’ 16.8 pts
â””â”€ TOTAL: 83.2 â†’ EPIC ğŸ’œ

Profile C: "The Casual User"
â”œâ”€ Casts: 250 â†’ 2.5 pts
â”œâ”€ Likes: 800 â†’ 3.2 pts
â”œâ”€ Replies: 80 â†’ 1.9 pts
â”œâ”€ Recasts: 60 â†’ 1.4 pts
â”œâ”€ Followers: 40 â†’ 1.6 pts
â”œâ”€ Consistency: 7/12 â†’ 11.7 pts
â”œâ”€ Unique: 95 â†’ 5.7 pts
â””â”€ TOTAL: 28 â†’ COMMON ğŸ”˜

WEIGHT RATIONALE:

Why Consistency = 20% (highest single metric)?
âœ… Rewards long-term engagement
âœ… Harder to game than raw post count
âœ… Shows genuine community participation
âœ… Encourages sustained activity

Why Unique Interactors = 18%?
âœ… Quality > quantity indicator
âœ… Shows authentic reach
âœ… Hard to fake (requires real engagement)
âœ… Correlates with community value

Why Casts = Only 10%?
âœ… Prevents spam incentive
âœ… Quality matters more than volume
âœ… Balances with engagement metrics
âœ… A few high-quality casts > many low-quality

SOLIDITY IMPLEMENTATION:

function _calculateRarity(
    uint16 casts,
    uint16 likes,
    uint16 replies,
    uint16 recasts,
    uint16 followers,
    uint8 consistency,
    uint32 uniqueInteractors
) internal pure returns (uint8 tier) {
    // Calculate weighted score (max 100)
    uint256 score = 
        _min((uint256(casts) * 10) / 1000, 10) +
        _min((uint256(likes) * 20) / 5000, 20) +
        _min((uint256(replies) * 12) / 500, 12) +
        _min((uint256(recasts) * 12) / 500, 12) +
        _min((uint256(followers) * 8) / 200, 8) +
        (uint256(consistency) * 20) / 12 +
        _min((uint256(uniqueInteractors) * 18) / 300, 18);
    
    // Cap at 100
    if (score > 100) score = 100;
    
    // Map to tier
    if (score >= 85) return 4; // Legendary
    if (score >= 70) return 3; // Epic
    if (score >= 50) return 2; // Rare
    if (score >= 30) return 1; // Uncommon
    return 0; // Common
}

function _min(uint256 a, uint256 b) internal pure returns (uint256) {
    return a < b ? a : b;
}


================================================================================
7ï¸âƒ£ STATS VERIFICATION & SECURITY
================================================================================

SECURITY MODEL:

Threat Model:
ğŸ”´ Attack Vector 1: User submits fake stats
ğŸ”´ Attack Vector 2: Replay attack (reuse old signature)
ğŸ”´ Attack Vector 3: Front-running (steal signature)
ğŸ”´ Attack Vector 4: Sybil attack (multiple mints)

Defenses:
âœ… Backend signature verification (trusted oracle)
âœ… Timestamp-bound signatures (10 min expiry)
âœ… On-chain FID â†’ address binding
âœ… Rate limiting on backend

ARCHITECTURE:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TRUSTED ORACLE PATTERN                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Backend (Trusted)                    Smart Contract           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 1. Fetch stats  â”‚                  â”‚ 4. Verify sig    â”‚    â”‚
â”‚  â”‚    from Neynar  â”‚                  â”‚    via ecrecover â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚           â”‚                                    â”‚               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 2. Generate     â”‚                  â”‚ 5. If valid,     â”‚    â”‚
â”‚  â”‚    signature    â”‚â”€â”€â”€â”€â”€signatureâ”€â”€â”€â”€â–¶â”‚    mint NFT      â”‚    â”‚
â”‚  â”‚    (ECDSA)      â”‚                  â”‚                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚           â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚  â”‚ 3. Return       â”‚                                          â”‚
â”‚  â”‚    {stats, sig} â”‚                                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

BACKEND API SIGNATURE GENERATION:

// backend/services/statsService.js
const ethers = require('ethers');

async function generateStatsSignature(fid, stats) {
  const year = new Date().getUTCFullYear();
  
  const hash = ethers.solidityPackedKeccak256(
    [
      'uint32', 'string', 'uint16', 'uint16', 'uint16', 'uint16',
      'uint16', 'uint8', 'uint32', 'uint16', 'uint256'
    ],
    [
      fid, stats.username, stats.casts, stats.likes,
      stats.replies, stats.recasts, stats.followers,
      stats.consistency, stats.uniqueInteractors, year,
      Math.floor(Date.now() / 1000) // timestamp
    ]
  );
  
  const wallet = new ethers.Wallet(process.env.STATS_ORACLE_PRIVATE_KEY);
  const signature = await wallet.signMessage(ethers.getBytes(hash));
  
  return {
    hash,
    signature,
    expiresAt: Date.now() + (10 * 60 * 1000) // 10 min expiry
  };
}

SMART CONTRACT SIGNATURE VERIFICATION:

function _verifySignature(
    bytes32 hash,
    bytes calldata signature
) internal view returns (bool) {
    bytes32 ethSignedHash = keccak256(
        abi.encodePacked("\x19Ethereum Signed Message:\n32", hash)
    );
    
    address signer = _recoverSigner(ethSignedHash, signature);
    return signer == statsOracle;
}

function _recoverSigner(
    bytes32 ethSignedHash,
    bytes memory signature
) internal pure returns (address) {
    require(signature.length == 65, "Invalid signature length");
    
    bytes32 r;
    bytes32 s;
    uint8 v;
    
    assembly {
        r := mload(add(signature, 32))
        s := mload(add(signature, 64))
        v := byte(0, mload(add(signature, 96)))
    }
    
    if (v < 27) v += 27;
    
    return ecrecover(ethSignedHash, v, r, s);
}

NEYNAR API INTEGRATION:

const { NeynarAPIClient } = require('@neynar/nodejs-sdk');
const neynar = new NeynarAPIClient(process.env.NEYNAR_API_KEY);

async function fetchNeynarStats(fid) {
  const toDate = new Date();
  const fromDate = new Date(toDate);
  fromDate.setDate(fromDate.getDate() - 365);
  
  const user = await neynar.fetchBulkUsers([fid]);
  const profile = user.users[0];
  
  const casts = await neynar.fetchCastsForUser(fid, { limit: 1000 });
  
  const stats = {
    username: profile.username,
    casts: casts.casts.length,
    likes: casts.casts.reduce((sum, cast) => sum + cast.reactions.likes_count, 0),
    replies: casts.casts.filter(c => c.parent_hash).length,
    recasts: casts.casts.reduce((sum, cast) => sum + cast.reactions.recasts_count, 0),
    followers: profile.follower_count,
    consistency: calculateConsistency(casts.casts, fromDate, toDate),
    uniqueInteractors: calculateUniqueInteractors(casts.casts)
  };
  
  return stats;
}


================================================================================
8ï¸âƒ£ NFT METADATA & SVG GENERATION
================================================================================

METADATA STANDARD: ERC721 + OpenSea Extensions

Full metadata structure:
{
  "name": "Farcaster Card #42 (2025)",
  "description": "1-Year Farcaster activity stats for FID 12345",
  "image": "data:image/svg+xml;base64,PHN2ZyB4bWxu...",
  "external_url": "https://yearly.cards/42",
  "attributes": [
    {"trait_type": "FID", "value": 12345},
    {"trait_type": "Year Minted", "value": 2025},
    {"trait_type": "Casts", "value": 954, "display_type": "number"},
    {"trait_type": "Likes Received", "value": 12044, "display_type": "number"},
    {"trait_type": "Replies", "value": 342, "display_type": "number"},
    {"trait_type": "Recasts", "value": 587, "display_type": "number"},
    {"trait_type": "Followers Gained", "value": 156, "display_type": "number"},
    {"trait_type": "Consistency", "value": "11/12"},
    {"trait_type": "Unique Interactors", "value": 287, "display_type": "number"},
    {"trait_type": "Rarity Tier", "value": "Legendary"},
    {"trait_type": "Rarity Score", "value": 92, "max_value": 100}
  ]
}

SVG GENERATION (Solidity):

function _generateSVG(
    uint256 tokenId,
    CardData memory card
) internal view returns (string memory) {
    string memory rarityColor = _getRarityColor(card.rarityTier);
    string memory rarityName = _getRarityName(card.rarityTier);
    string memory username = _getUsername(tokenId, card);
    
    return string(abi.encodePacked(
        '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 600">',
        '<defs>',
          '<linearGradient id="bg" x1="0%" y1="0%" x2="100%" y2="100%">',
            '<stop offset="0%" style="stop-color:', rarityColor, ';stop-opacity:1"/>',
            '<stop offset="100%" style="stop-color:#000;stop-opacity:0.85"/>',
          '</linearGradient>',
        '</defs>',
        '<rect width="400" height="600" fill="url(#bg)"/>',
        '<rect x="20" y="20" width="360" height="560" fill="rgba(0,0,0,0.5)" rx="15"/>',
        '<text x="200" y="70" text-anchor="middle" fill="#fff" font-size="32" font-weight="bold">',
        'FARCASTER ', Strings.toString(card.yearMinted), '</text>',
        '<text x="200" y="105" text-anchor="middle" fill="', rarityColor, '" font-size="16">',
        rarityName, ' CARD</text>',
        '<text x="200" y="160" text-anchor="middle" fill="#fff" font-size="24">@', username, '</text>',
        _generateStatsGrid(card),
        '</svg>'
    ));
}

function _getRarityColor(uint8 tier) internal pure returns (string memory) {
    if (tier == 4) return "#FFD700"; // Legendary - Gold
    if (tier == 3) return "#9B59B6"; // Epic - Purple
    if (tier == 2) return "#3498DB"; // Rare - Blue
    if (tier == 1) return "#2ECC71"; // Uncommon - Green
    return "#95A5A6"; // Common - Gray
}


================================================================================
9ï¸âƒ£ ROYALTY SYSTEM (ERC2981)
================================================================================

IMPLEMENTATION:

function royaltyInfo(
    uint256 tokenId,
    uint256 salePrice
) external view override returns (
    address receiver,
    uint256 royaltyAmount
) {
    require(_exists(tokenId), "Token does not exist");
    
    CardData memory card = _cards[tokenId];
    receiver = card.minter;
    royaltyAmount = (salePrice * ROYALTY_BPS) / 10000;
    
    return (receiver, royaltyAmount);
}

EXAMPLE SCENARIOS:

Scenario 1: Card sells for 0.01 ETH ($30)
â”œâ”€ Royalty: 0.0003 ETH ($0.90) â†’ original minter
â”œâ”€ OpenSea fee: 0.00025 ETH ($0.75) â†’ marketplace
â””â”€ Seller receives: 0.00945 ETH ($28.35)

Scenario 2: Card sells for 0.1 ETH ($300)
â”œâ”€ Royalty: 0.003 ETH ($9.00) â†’ original minter
â”œâ”€ OpenSea fee: 0.0025 ETH ($7.50) â†’ marketplace
â””â”€ Seller receives: 0.0945 ETH ($283.50)

MINTER LIFETIME VALUE:

If card traded 5 times at avg $25/sale:
- Royalty per sale: $0.75
- Total royalty earned: $3.75
- Original mint cost: $2.10
- Net gain: $1.65 (78% ROI)


================================================================================
ğŸ”Ÿ MINTING RULES & ELIGIBILITY
================================================================================

CORE RULES:

Rule 1: ONE MINT PER CALENDAR YEAR
â”œâ”€ Each FID can mint maximum 1 card per calendar year
â”œâ”€ Year = UTC year (2025, 2026, etc.)
â””â”€ Check: require(_lastMintYear[fid] != currentYear)

Rule 2: ROLLING STATS WINDOW
â”œâ”€ Stats calculated from: mintDate - 365 days â†’ mintDate
â”œâ”€ NOT calendar year (Jan-Dec)
â””â”€ Example: Mint May 15, 2025 â†’ stats from May 15, 2024

Rule 3: ELIGIBILITY RESET
â”œâ”€ Reset happens: Every January 1st 00:00 UTC
â”œâ”€ After reset: User can mint again
â””â”€ Example: Mint Dec 20, 2025 â†’ eligible again Jan 1, 2026

Rule 4: EXACT MINT FEE
â”œâ”€ Must pay exactly 0.0005 ETH
â”œâ”€ Gas fee paid separately to network
â””â”€ Fee sent to contract (owner can withdraw)

Rule 5: VALID SIGNATURE REQUIRED
â”œâ”€ Stats must be signed by trusted backend
â”œâ”€ Signature includes timestamp (10 min expiry)
â””â”€ Signature verified on-chain via ecrecover()


================================================================================
1ï¸âƒ£1ï¸âƒ£ LEADERBOARD SYSTEM
================================================================================

CATEGORIES (7 Total):

1. ğŸ† Most Casts (12-month window)
2. â¤ï¸ Most Likes Received
3. ğŸ’¬ Highest Engagement Rate
4. ğŸ“… Perfect Consistency (12/12)
5. â­ Highest Rarity Score
6. ğŸ’° Top Traders (most royalty earned)
7. ğŸ’ Most Valuable Card (highest sale price)

REDIS SCHEMA:

Key Pattern: leaderboard:{category}:{year}
Type: Sorted Set (ZADD)

Examples:
- leaderboard:casts:2025
- leaderboard:likes:2025
- leaderboard:rarity:2025

REDIS OPERATIONS:

// Add entry
await redis.zadd('leaderboard:casts:2025', 954, 'fid:12345');

// Get top 100
const top100 = await redis.zrevrange('leaderboard:casts:2025', 0, 99, 'WITHSCORES');

// Get user's rank
const rank = await redis.zrevrank('leaderboard:casts:2025', 'fid:12345');


================================================================================
1ï¸âƒ£2ï¸âƒ£ FRAME INTEGRATION (FARCASTER)
================================================================================

FRAME FLOW:

Frame 1: HOME
â”œâ”€ Display: "Mint Your 2025 Card"
â”œâ”€ Show: Minted status / countdown to reset
â””â”€ Button: "Check Eligibility"

Frame 2: STATS PREVIEW
â”œâ”€ Display: 7 stats + predicted rarity tier
â”œâ”€ Show: "You'll get LEGENDARY tier!"
â””â”€ Button: "Mint Now (0.0005 ETH)"

Frame 3: MINT CONFIRMATION
â”œâ”€ Display: Total cost (~$2.10)
â”œâ”€ Show: Fee breakdown (protocol + gas)
â””â”€ Button: "Confirm & Mint"

Frame 4: SUCCESS
â”œâ”€ Display: Beautiful card (SVG rendered)
â”œâ”€ Show: Token ID + rarity tier
â””â”€ Buttons: Share | BaseScan | OpenSea

SHARE TO FARCASTER:

Auto-generated cast:
"I just minted my 2025 Farcaster Yearly Card! ğŸ´

â­ Legendary Tier (92/100)
ğŸ“Š 12k likes â€¢ 954 casts â€¢ 11/12 consistency

Mint yours â†’ [frame-url]"


================================================================================
1ï¸âƒ£3ï¸âƒ£ ECONOMIC MODEL & SUSTAINABILITY
================================================================================

COST STRUCTURE:

Monthly Operating Costs:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Service               â”‚ Plan              â”‚ Cost/Month         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Backend Hosting       â”‚ Railway Pro       â”‚ $20                â”‚
â”‚ Redis Cache           â”‚ Upstash Free      â”‚ $0                 â”‚
â”‚ Neynar API            â”‚ Growth            â”‚ $50                â”‚
â”‚ Domain & CDN          â”‚ Vercel Pro        â”‚ $20                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TOTAL                 â”‚                   â”‚ ~$90/month         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Break-Even Analysis:
- Monthly costs: $90
- Revenue per mint: ~$1.50 (at $3000 ETH)
- Break-even: 60 mints/month
- Daily target: 2 mints/day

REVENUE PROJECTIONS:

Conservative (Year 1):
â”œâ”€ Mints: 2,430
â”œâ”€ Revenue: $3,645
â”œâ”€ Costs: $1,080
â”œâ”€ Net Profit: $2,565
â””â”€ Break-even: Month 2

Moderate (Year 1):
â”œâ”€ Mints: 5,000
â”œâ”€ Revenue: $7,500
â”œâ”€ Costs: $1,080
â”œâ”€ Net Profit: $6,420
â””â”€ Break-even: Month 1

Optimistic (Year 1):
â”œâ”€ Mints: 10,000
â”œâ”€ Revenue: $15,000
â”œâ”€ Costs: $1,080
â”œâ”€ Net Profit: $13,920
â””â”€ Break-even: Month 1

USER ECONOMICS:

What user gets for $2.10:
âœ… Unique NFT (collectible value)
âœ… Social proof (on-chain stats)
âœ… 3% perpetual royalties (passive income)
âœ… Trading rights (can flip on OpenSea)

ROI Timeline:
- 3 sales at $25 â†’ $2.25 royalty (ROI: +7%)
- 5 sales at $30 â†’ $4.50 royalty (ROI: +114%)
- 10 sales at $50 â†’ $15 royalty (ROI: +614%)


================================================================================
1ï¸âƒ£4ï¸âƒ£ DEPLOYMENT GUIDE
================================================================================

STEP 1: SMART CONTRACT DEPLOYMENT

1. Setup Hardhat:
npm init -y
npm install --save-dev hardhat @nomicfoundation/hardhat-toolbox
npx hardhat init

2. Configure hardhat.config.js:
networks: {
  base: {
    url: "https://mainnet.base.org",
    accounts: [DEPLOYER_PRIVATE_KEY],
    chainId: 8453
  }
}

3. Deploy:
npx hardhat run scripts/deploy.js --network base

4. Verify:
npx hardhat verify --network base DEPLOYED_ADDRESS ORACLE_ADDRESS

Expected Cost: ~$25-35

STEP 2: BACKEND API DEPLOYMENT

1. Setup Express:
mkdir backend && cd backend
npm init -y
npm install express ethers dotenv cors redis @neynar/nodejs-sdk

2. Deploy to Railway:
railway init
railway up

Cost: $5-20/month

STEP 3: FRAME DEPLOYMENT

1. Setup Frog:
npm create frog
# Choose: Vercel template

2. Deploy to Vercel:
vercel --prod

Cost: $0-20/month


================================================================================
1ï¸âƒ£5ï¸âƒ£ TESTING STRATEGY
================================================================================

UNIT TESTS (Hardhat):

describe("FarcasterYearlyCard", function () {
  it("Should mint with valid signature", async function () {
    // Generate signature
    const signature = await statsOracle.signMessage(...);
    
    // Mint
    await expect(
      contract.connect(user1).mint(..., signature, { value: MINT_FEE })
    ).to.emit(contract, "CardMinted");
    
    expect(await contract.ownerOf(1)).to.equal(user1.address);
  });
  
  it("Should reject double mint in same year", async function () {
    await contract.connect(user1).mint(...);
    
    await expect(
      contract.connect(user1).mint(...)
    ).to.be.revertedWith("Already minted this year");
  });
  
  it("Should calculate Legendary tier correctly", async function () {
    const stats = {
      casts: 2000, likes: 10000, replies: 800,
      recasts: 700, followers: 300, consistency: 12,
      uniqueInteractors: 400
    };
    
    await contract.connect(user1).mint(...);
    const card = await contract.getCardData(1);
    
    expect(card.rarityTier).to.equal(4); // Legendary
  });
});

Run tests:
npx hardhat test
npx hardhat coverage


================================================================================
1ï¸âƒ£6ï¸âƒ£ EDGE CASES & ERROR HANDLING
================================================================================

EDGE CASES:

1. NEW USER (FID < 365 days old)
   â””â”€ Stats will be incomplete, likely Common tier
   â””â”€ Still eligible to mint

2. INACTIVE USER (0 casts)
   â””â”€ All stats = 0, Common tier
   â””â”€ Still can mint (historical proof)

3. DELETED ACCOUNT
   â””â”€ Neynar API returns 404
   â””â”€ Cannot mint new card
   â””â”€ Existing NFTs remain valid

4. USERNAME CHANGE
   â””â”€ Card stores username at mint time
   â””â”€ Creates "vintage" collectible value

5. STATS OVERFLOW (>65,535)
   â””â”€ Cap at max uint16 value
   â””â”€ Still Legendary tier

6. YEAR BOUNDARY
   â””â”€ Mint Dec 31 â†’ allowed
   â””â”€ Mint Jan 1 â†’ allowed (new year)

7. SIGNATURE EXPIRY
   â””â”€ Valid for 10 minutes
   â””â”€ User must re-fetch if expired

ERROR HANDLING:

Smart Contract Errors:
error InvalidFee();
error AlreadyMinted();
error InvalidSignature();
error TokenDoesNotExist();

Frontend Error Messages:
'InvalidFee': 'Please send exactly 0.0005 ETH'
'AlreadyMinted': 'You\'ve already minted this year. Come back January 1!'
'InvalidSignature': 'Stats verification failed. Please refresh.'


================================================================================
1ï¸âƒ£7ï¸âƒ£ ROADMAP & FUTURE FEATURES
================================================================================

PHASE 1: LAUNCH (Month 1-3) âœ…
âœ… Smart contract deployment
âœ… Basic minting (1 per year)
âœ… Rarity system (5 tiers)
âœ… Farcaster Frame
âœ… Leaderboard

PHASE 2: ENHANCEMENTS (Month 4-6)
ğŸ”² Achievement Badges
ğŸ”² Advanced Analytics Dashboard
ğŸ”² Card Showcase Gallery
ğŸ”² Referral System

PHASE 3: SOCIAL FEATURES (Month 7-9)
ğŸ”² Card Trading Platform
ğŸ”² Card Comparisons
ğŸ”² Collaborative Cards
ğŸ”² Card Staking

PHASE 4: EXPANSION (Month 10-12)
ğŸ”² Multi-Chain Deployment
ğŸ”² Historical Archives
ğŸ”² Special Editions
ğŸ”² Mobile App

PHASE 5: ECOSYSTEM (Year 2)
ğŸ”² Developer API
ğŸ”² Reputation System
ğŸ”² Gamification Layer
ğŸ”² DAO Governance

SUCCESS METRICS:

Year 1 Targets:
â”œâ”€ 10,000 total mints
â”œâ”€ 5,000 unique minters
â”œâ”€ $15,000 protocol revenue
â”œâ”€ $50,000 secondary trading volume
â”œâ”€ 60% retention (mint again in Year 2)
â””â”€ 4.5/5 average user rating


================================================================================
1ï¸âƒ£8ï¸âƒ£ APPENDIX & RESOURCES
================================================================================

USEFUL LINKS:

Documentation:
â”œâ”€ Solidity Docs: https://docs.soliditylang.org
â”œâ”€ Hardhat: https://hardhat.org/docs
â”œâ”€ Frog Framework: https://frog.fm
â”œâ”€ Neynar API: https://docs.neynar.com
â”œâ”€ Base Chain: https://docs.base.org
â””â”€ OpenSea: https://docs.opensea.io

Tools:
â”œâ”€ RemixIDE: https://remix.ethereum.org
â”œâ”€ BaseScan: https://basescan.org
â”œâ”€ OpenSea Testnet: https://testnets.opensea.io
â””â”€ Upstash: https://upstash.com

KEY ENVIRONMENT VARIABLES:

CONTRACT_ADDRESS=0x...
DEPLOYER_PRIVATE_KEY=0x...
STATS_ORACLE_PRIVATE_KEY=0x...
NEYNAR_API_KEY=...
REDIS_URL=redis://...
BASESCAN_API_KEY=...

GAS OPTIMIZATION SUMMARY:

Total Savings Achieved:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Optimization                â”‚ Gas Saved  â”‚ Cost Saved         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Data packing (2 slots)      â”‚  ~160,000  â”‚ $1.20 per mint     â”‚
â”‚ On-demand SVG               â”‚   ~30,000  â”‚ $0.22 per mint     â”‚
â”‚ Simple eligibility check    â”‚   ~18,000  â”‚ $0.14 per mint     â”‚
â”‚ Solady ERC721               â”‚   ~15,000  â”‚ $0.11 per mint     â”‚
â”‚ Minimal events              â”‚    ~6,000  â”‚ $0.04 per mint     â”‚
â”‚ Immutable variables         â”‚    ~2,000  â”‚ $0.02 per mint     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TOTAL                       â”‚  ~231,000  â”‚ $1.73 per mint     â”‚
â”‚                                                                 â”‚
â”‚ Before optimization: ~450k gas (~$3.30)                        â”‚
â”‚ After optimization:  ~150k gas (~$0.60)                        â”‚
â”‚ Savings: 67% reduction in gas costs                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TECH STACK SUMMARY:

Frontend: Frog (Hono + React) â†’ Vercel ($0-20/mo)
Backend: Node.js + Express â†’ Railway ($20-50/mo)
Blockchain: Base L2 â†’ ~$30 one-time deployment
Database: Redis (Upstash) â†’ Free tier
APIs: Neynar ($50/mo)

Total Monthly: ~$90

DEPLOYMENT TIMELINE:

Week 1: Development (smart contract + backend + frame)
Week 2: Testing (unit + integration + E2E)
Week 3: Pre-Launch (mainnet deploy + security + beta)
Week 4: Launch (public release + monitoring)


================================================================================
                              END OF BLUEPRINT
================================================================================

Version: 2.0 - Complete Production-Ready Specification
Last Updated: November 22, 2025
Status: Ready for Implementation

Total Deployment Cost: ~$100 (contract + initial setup)
Monthly Operating Cost: ~$90
Break-Even: 60 mints/month (~2 per day)
Target Year 1 Revenue: $7,500-$15,000

Key Success Metrics:
âœ… Gas cost: <$0.80 per mint
âœ… Response time: <500ms API
âœ… Uptime: >99.9%
âœ… User satisfaction: >4.5/5
âœ… Retention: >60% year-over-year

This blueprint provides everything needed to build, deploy, and scale
a sustainable NFT project on Base that genuinely serves the Farcaster
community while maintaining economic viability.

Repository: github.com/anotherbobby/yearlysocialcard

Good luck! ğŸš€

================================================================================